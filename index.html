<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservas de Restaurante</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #d4af37;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --text-light: #7f8c8d;
            --bg-light: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
            font-size: 1.5rem;
        }

        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><rect fill="%23212529" width="1200" height="600"/><circle fill="%23495057" cx="200" cy="150" r="80"/><circle fill="%236c757d" cx="800" cy="300" r="120"/><circle fill="%23adb5bd" cx="1000" cy="100" r="60"/></svg>');
            background-size: cover;
            background-position: center;
            padding: 120px 0;
            color: white;
            text-align: center;
        }

        .hero-section h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .hero-section p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), #f39c12);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 50px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .about-section {
            background: white;
            padding: 80px 0;
        }

        .about-image {
            position: relative;
        }

        .about-image::before {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary-color), #f39c12);
            border-radius: 15px;
            z-index: -1;
        }

        .menu-section {
            padding: 80px 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .menu-carousel .carousel-item {
            padding: 0 15px;
        }

        .menu-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            height: 100%;
        }

        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .menu-card-img {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .menu-card-price {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .menu-card-body {
            padding: 25px;
        }

        .menu-card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .menu-card-description {
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .menu-ingredients {
            font-size: 0.9rem;
            color: var(--primary-color);
            font-style: italic;
        }

        .carousel-control-prev,
        .carousel-control-next {
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.8;
        }

        .carousel-control-prev {
            left: -25px;
        }

        .carousel-control-next {
            right: -25px;
        }

        .carousel-control-prev:hover,
        .carousel-control-next:hover {
            opacity: 1;
        }

        .testimonial-carousel .carousel-item {
            padding: 0 20px;
        }

        .testimonial-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .testimonial-card .fa-quote-left {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        .testimonial-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            flex-grow: 1;
        }

        .testimonial-author {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 20px;
        }

        .testimonial-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .testimonial-position {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .carousel-indicators {
            bottom: -50px;
        }

        .carousel-indicators [data-bs-target] {
            background-color: var(--primary-color);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 5px;
        }

        .reservation-section {
            padding: 80px 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .reservation-form {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }

        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(212, 175, 55, 0.25);
        }

        .form-label {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 8px;
        }

        .reservations-list {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .reservation-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .reservation-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .testimonial-section {
            padding: 80px 0;
            background: var(--secondary-color);
            color: white;
        }

        .testimonial-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .testimonial-card .fa-quote-left {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        footer {
            background: #1a1a1a;
            color: white;
            padding: 50px 0 20px;
        }

        .footer-links a {
            color: #adb5bd;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--primary-color);
        }

        .social-links a {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            text-align: center;
            line-height: 40px;
            border-radius: 50%;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: #f39c12;
            transform: translateY(-3px);
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 50px;
            color: var(--secondary-color);
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: var(--primary-color);
        }

        @media (max-width: 768px) {
            .hero-section h1 {
                font-size: 2.5rem;
            }

            .hero-section p {
                font-size: 1.1rem;
            }

            .reservation-form {
                padding: 30px 20px;
            }
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .alert {
            border-radius: 10px;
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <!-- Navegación -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#inicio">
                <i class="fas fa-utensils"></i> Restaurante Gourmet
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#inicio">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="#menu">Platillos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#reservas">Reservas</a></li>
                    <li class="nav-item"><a class="nav-link" href="#testimonios">Testimonios</a></li>
                    <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Sección Hero -->
    <section id="inicio" class="hero-section">
        <div class="container">
            <h1>Restaurante Gourmet</h1>
            <p class="lead">Donde la tradición culinaria se encuentra con la innovación gastronómica</p>
            <a href="#reservas" class="btn btn-primary btn-lg">
                <i class="fas fa-calendar-alt"></i> Reservar Mesa
            </a>
        </div>
    </section>

    <!-- Sección Quiénes Somos -->
    <section class="about-section py-5">
        <div class="container">
            <div class="row align-items-center">
                <!-- Texto -->
                <div class="col-lg-6">
                    <h2 class="section-title text-start">¿Quiénes Somos?</h2>
                    <p class="lead mb-4">Somos un restaurante gourmet con más de 20 años de experiencia en alta cocina,
                        dedicados a ofrecer una experiencia gastronómica única e inolvidable.</p>
                    <p class="mb-4">Nuestros chefs, con formación internacional, han creado un menú que fusiona
                        técnicas culinarias tradicionales con toques modernos, utilizando únicamente ingredientes
                        frescos y de la más alta calidad.</p>
                    <p class="mb-4">Creemos que cada comida es una celebración, y nuestro objetivo es crear momentos
                        especiales para nuestros huéspedes en un ambiente elegante y acogedor.</p>
                    <div class="row mt-4">
                        <div class="col-6">
                            <div class="text-center">
                                <h3 class="text-primary mb-0">20+</h3>
                                <small class="text-muted">Años de Experiencia</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <h3 class="text-primary mb-0">4.95 ★★★★★</h3>
                                <small class="text-muted">Calificación Promedio</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Slider corregido con altura fija y object-fit -->
                <div class="col-lg-6">
                    <div id="exoticDishesCarousel" class="carousel slide shadow rounded overflow-hidden"
                        data-bs-ride="carousel" style="height: 400px;">
                        <div class="carousel-inner h-100">
                            <div class="carousel-item active h-100">
                                <img src="images/enchiladas-comida-mexicana.jpg" class="d-block w-100 h-100"
                                    style="object-fit: cover;" alt="Platillo Exótico 1">
                            </div>
                            <div class="carousel-item h-100">
                                <img src="images/tacos-comida-mexicana.jpg" class="d-block w-100 h-100"
                                    style="object-fit: cover;" alt="Platillo Exótico 2">
                            </div>
                            <div class="carousel-item h-100">
                                <img src="images/tamales-comida-mexicana.jpg" class="d-block w-100 h-100"
                                    style="object-fit: cover;" alt="Platillo Exótico 3">
                            </div>
                            <div class="carousel-item h-100">
                                <img src="images/enchiladas-comida-mexicana.jpg" class="d-block w-100 h-100"
                                    style="object-fit: cover;" alt="Platillo Exótico 4">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#exoticDishesCarousel"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon bg-dark rounded-circle p-2"
                                aria-hidden="true"></span>
                            <span class="visually-hidden">Anterior</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#exoticDishesCarousel"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon bg-dark rounded-circle p-2"
                                aria-hidden="true"></span>
                            <span class="visually-hidden">Siguiente</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Formulario de Reservas -->
    <section id="reservas" class="reservation-section">
        <div class="container">
            <h2 class="section-title">Reservar una Mesa</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="reservation-form">
                        <form id="reservaForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nombre" class="form-label">
                                            <i class="fas fa-user"></i> Nombre Completo
                                        </label>
                                        <input type="text" class="form-control" id="nombre"
                                            placeholder="Tu nombre completo" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="telefono" class="form-label">
                                            <i class="fas fa-phone"></i> Teléfono
                                        </label>
                                        <input type="tel" class="form-control" id="telefono"
                                            placeholder="Tu número de teléfono" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="fecha" class="form-label">
                                            <i class="fas fa-calendar"></i> Fecha
                                        </label>
                                        <input type="date" class="form-control" id="fecha" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="hora" class="form-label">
                                            <i class="fas fa-clock"></i> Hora
                                        </label>
                                        <input type="time" class="form-control" id="hora" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="personas" class="form-label">
                                            <i class="fas fa-users"></i> Personas
                                        </label>
                                        <select class="form-control" id="personas" required>
                                            <option value="">Seleccionar...</option>
                                            <option value="2">2 personas - $100</option>
                                            <option value="3">3 personas - $150</option>
                                            <option value="4">4 personas - $200</option>
                                            <option value="5">5 personas - $250</option>
                                            <option value="6">6 personas - $300</option>
                                            <option value="7">7 personas - $350</option>
                                            <option value="8+">8+ personas - $400</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="comentarios" class="form-label">
                                    <i class="fas fa-comment"></i> Comentarios especiales (opcional)
                                </label>
                                <textarea class="form-control" id="comentarios" rows="3"
                                    placeholder="Cumpleaños, celebraciones especiales, adaptaciones, etc."></textarea>
                            </div>
                            <div class="text-center">
                                <p id="precioReserva" class="text-primary h5"></p>
                                <button type="submit" class="btn btn-primary btn-lg mb-3">
                                    <i class="fas fa-check"></i> Confirmar Reserva
                                </button>

                            </div>
                        </form>
                        <div class="loading-spinner" id="loadingSpinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                            <p class="mt-2">Procesando reserva...</p>
                        </div>

                        <div id="alertContainer"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Lista de Reservas -->

    <div class="row mt-5">
        <div class="col-lg-10 mx-auto">
            <div class="reservations-list">
                <h3 class="text-center mb-4">
                    <i class="fas fa-list"></i> Reservas Actuales
                </h3>
                <div id="reservasList">
                    <div class="text-center text-muted">
                        <i class="fas fa-calendar-times fa-3x mb-3"></i>
                        <p>No hay reservas disponibles</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </section>

    <!-- Testimonios -->
    <section id="testimonios" class="testimonial-section">
        <div class="container">
            <h2 class="section-title text-white">Lo que dicen nuestros clientes</h2>
            <div id="testimonialsCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="testimonial-card">
                                    <i class="fas fa-quote-left"></i>
                                    <p class="testimonial-text">"Una experiencia gastronómica excepcional. Cada platillo
                                        es una obra de arte y el servicio es impecable. Definitivamente nuestro
                                        restaurante favorito para ocasiones especiales."</p>
                                    <div class="testimonial-author">
                                        <h5 class="testimonial-name">María González</h5>
                                        <small class="testimonial-position">Empresaria</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="testimonial-card">
                                    <i class="fas fa-quote-left"></i>
                                    <p class="testimonial-text">"El sistema de reservas es súper fácil de usar y el
                                        ambiente del restaurante es perfecto. La comida siempre supera nuestras
                                        expectativas. ¡Altamente recomendado!"</p>
                                    <div class="testimonial-author">
                                        <h5 class="testimonial-name">Carlos Mendoza</h5>
                                        <small class="testimonial-position">Chef Consultor</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="testimonial-card">
                                    <i class="fas fa-quote-left"></i>
                                    <p class="testimonial-text">"Celebramos nuestro aniversario aquí y fue mágico. La
                                        atención al detalle es extraordinaria y cada bocado es una experiencia única.
                                        Volveremos pronto."</p>
                                    <div class="testimonial-author">
                                        <h5 class="testimonial-name">Ana y Roberto Jiménez</h5>
                                        <small class="testimonial-position">Pareja Frecuente</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="testimonial-card">
                                    <i class="fas fa-quote-left"></i>
                                    <p class="testimonial-text">"Como crítico gastronómico, puedo decir que este lugar
                                        establece el estándar. La innovación culinaria y la presentación son de clase
                                        mundial."</p>
                                    <div class="testimonial-author">
                                        <h5 class="testimonial-name">Diego Ramírez</h5>
                                        <small class="testimonial-position">Crítico Gastronómico</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="0"
                        class="active"></button>
                    <button type="button" data-bs-target="#testimonialsCarousel" data-bs-slide-to="1"></button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contacto">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5><i class="fas fa-utensils"></i> Restaurante Gourmet</h5>
                    <p class="text-muted">Experiencia culinaria excepcional con tecnología de vanguardia.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Enlaces Rápidos</h5>
                    <div class="footer-links">
                        <a href="#acerca" class="d-block mb-2">Acerca de Nosotros</a>
                        <a href="#politica" class="d-block mb-2">Política de Privacidad</a>
                        <a href="#terminos" class="d-block mb-2">Términos de Servicio</a>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Síguenos</h5>
                    <div class="social-links">
                        <a href="https://facebook.com" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://instagram.com" target="_blank"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center">
                <p class="mb-0">&copy; 2025 Restaurante Gourmet. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <!-- SDK PayPal -->
    <script
        src="https://www.paypal.com/sdk/js?client-id=AZSB8QnforcPVGIEbrEvl_LllQ0YcKGaHyepxONKT-NE68Uxy-TdMqTNyLIjbIPjgkix56wPc2VMD9Ah&currency=MXN"></script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import {
            getFirestore, collection, addDoc, getDocs,
            orderBy, query, doc, updateDoc, deleteDoc
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDMPjoDe8BwHLSNzgb09MBG2UzKroKpd9k",
            authDomain: "sistemadereservas-4feb9.firebaseapp.com",
            projectId: "sistemadereservas-4feb9",
            storageBucket: "sistemadereservas-4feb9.appspot.com",
            messagingSenderId: "928539352206",
            appId: "1:928539352206:web:6d948586b51038d644fddf"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const precios = { "2": 100, "3": 150, "4": 200, "5": 250, "6": 300, "7": 350, "8+": 400 };
        let precioSeleccionado = 0;

        function mostrarAlerta(msg, tipo = 'success') {
            const cont = document.getElementById('alertContainer');
            const div = document.createElement('div');
            div.className = `alert alert-${tipo} alert-dismissible fade show`;
            div.innerHTML = `${msg}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
            cont.appendChild(div);
            setTimeout(() => div.remove(), 5000);
        }

        function toggleSpinner(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
            document.getElementById('reservaForm').style.display = show ? 'none' : 'block';
        }

        async function yaExisteReserva(fecha, hora) {
            const q = query(collection(db, "reservas"));
            const snapshot = await getDocs(q);
            return snapshot.docs.some(docu => {
                const data = docu.data();
                return data.fecha === fecha && data.hora === hora && data.estado !== "cancelada";
            });
        }

        function getReservaForm(estado) {
            return {
                nombre: document.getElementById("nombre").value,
                telefono: document.getElementById("telefono").value,
                fecha: document.getElementById("fecha").value,
                hora: document.getElementById("hora").value,
                personas: parseInt(document.getElementById("personas").value, 10),
                comentarios: document.getElementById("comentarios").value || "",
                estado,
                timestamp: new Date().toISOString()
            };
        }

        async function guardarReserva(tipo) {
            toggleSpinner(true);
            try {
                const reserva = getReservaForm(tipo);
                const ahora = new Date();
                const fechaHora = new Date(`${reserva.fecha}T${reserva.hora}`);

                if (fechaHora < ahora) {
                    mostrarAlerta('No puedes reservar en una fecha y hora pasada.', 'danger');
                    toggleSpinner(false);
                    return;
                }

                if (await yaExisteReserva(reserva.fecha, reserva.hora)) {
                    mostrarAlerta('Ya existe una reserva para esa fecha y hora.', 'danger');
                    toggleSpinner(false);
                    return;
                }

                await addDoc(collection(db, "reservas"), reserva);
                mostrarAlerta(tipo === "pagada" ? 'Reserva pagada y guardada.' : 'Reserva guardada como pendiente.');
                document.getElementById("reservaForm").reset();
                document.getElementById("precioReserva").innerText = "";
                document.getElementById("paypal-button-container").style.display = "none";
                mostrarReservas();
            } catch (e) {
                console.error(e);
                mostrarAlerta('Error al guardar reserva', 'danger');
            } finally {
                toggleSpinner(false);
            }
        }

        document.getElementById("personas").addEventListener("change", e => {
            const value = e.target.value;
            precioSeleccionado = precios[value] || 0;
            const precioTexto = document.getElementById("precioReserva");
            const paypalContainer = document.getElementById("paypal-button-container");

            if (precioSeleccionado > 0) {
                precioTexto.innerText = `Total a pagar: $${precioSeleccionado} MXN`;
                paypalContainer.style.display = "block";
                paypalContainer.innerHTML = "";
                renderPayPal();
            } else {
                precioTexto.innerText = "";
                paypalContainer.style.display = "none";
            }
        });

        function renderPayPal() {
            if (typeof paypal === 'undefined') return;
            paypal.Buttons({
                createOrder: (_, actions) => actions.order.create({
                    purchase_units: [{ amount: { value: precioSeleccionado.toString() } }]
                }),
                onApprove: (_, actions) =>
                    actions.order.capture().then(() => guardarReserva("pagada"))
            }).render('#paypal-button-container');
        }

        document.getElementById('reservaForm').addEventListener('submit', async e => {
            e.preventDefault();
            guardarReserva("pendiente");
        });

        window.cancelarReserva = async function (id, estado) {
            if (!confirm("¿Estás seguro de que deseas cancelar esta reserva?")) return;

            try {
                const ref = doc(db, "reservas", id);
                if (estado === "pagada") {
                    await updateDoc(ref, { estado: "cancelada" });
                    mostrarAlerta("La reserva fue marcada como cancelada.", "warning");
                } else {
                    await deleteDoc(ref);
                    mostrarAlerta("La reserva fue eliminada exitosamente.", "success");
                }
                mostrarReservas();
            } catch (error) {
                console.error("Error al cancelar la reserva:", error);
                mostrarAlerta("No se pudo cancelar la reserva.", "danger");
            }
        };


        async function mostrarReservas() {
            const cont = document.getElementById("reservasList");
            try {
                const q = query(collection(db, "reservas"), orderBy("timestamp", "desc"));
                const snap = await getDocs(q);
                if (snap.empty) {
                    cont.innerHTML = "<p class='text-center text-muted'>No hay reservas.</p>";
                    return;
                }
                let html = '';
                snap.forEach(docu => {
                    const r = docu.data();
                    const estado = r.estado;
                    const badge = estado === "pagada" ? 'success' : estado === "cancelada" ? 'danger' : 'secondary';
                    const precio = r.personas <= 3 ? 100 : r.personas <= 5 ? 200 : r.personas <= 8 ? 300 : 400;
                    html += `
                <div class="card mb-3 shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title">${r.nombre}</h5>
                    <p class="card-text">
                      Fecha: ${r.fecha} - Hora: ${r.hora} - Personas: ${r.personas}<br>
                      Tel: ${r.telefono} - Comentarios: ${r.comentarios}
                    </p>
                    <span class="badge bg-${badge}">${estado}</span>
                    <button class="btn btn-outline-danger btn-sm float-end mt-2" onclick="cancelarReserva('${docu.id}','${estado}')">Cancelar</button>
                    ${estado === "pendiente" ? `<div class="mt-3" id="paypal-btn-${docu.id}"></div>` : ""}
                  </div>
                </div>`;

                    if (estado === "pendiente") {
                        setTimeout(() => {
                            if (typeof paypal !== 'undefined') {
                                paypal.Buttons({
                                    createOrder: (_, actions) => actions.order.create({
                                        purchase_units: [{ amount: { value: precio.toString() } }]
                                    }),
                                    onApprove: (_, actions) =>
                                        actions.order.capture().then(async () => {
                                            const ref = doc(db, "reservas", docu.id);
                                            await updateDoc(ref, { estado: "pagada", pagoId: "manual-paypal" });
                                            mostrarAlerta("Reserva pagada correctamente.");
                                            mostrarReservas();
                                        })
                                }).render(`#paypal-btn-${docu.id}`);
                            }
                        }, 100);
                    }
                });
                cont.innerHTML = html;
            } catch (e) {
                console.error(e);
                cont.innerHTML = "<p class='text-danger'>Error al cargar reservas.</p>";
            }
        }


        document.getElementById("fecha").min = new Date().toISOString().split("T")[0];
        mostrarReservas();
    </script>

</body>

</html>